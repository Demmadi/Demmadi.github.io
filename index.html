<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>الاستعلام عن أسعار ومواقع مواصلات مدينة سلفيت</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      height: 100%;
      width: 100%;
    }

    #map {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    #info-panel {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      max-width: 300px;
      z-index: 1000;
    }

    #info-panel h3 {
      margin: 0 0 10px;
      font-size: 16px;
    }

    #info-panel p {
      margin: 5px 0;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="info-panel">
    <h3>لوحة الاستعلام</h3>
    <p><strong>موقعك الحالي:</strong> <span id="user-location">غير محدد</span></p>
    <p><strong>أقرب محطة:</strong> <span id="nearest-station">جارٍ التحديد...</span></p>
    <p><strong>سعر المواصلات:</strong> <span id="transport-price">جارٍ التحديد...</span></p>
  </div>

  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script>
    // تعريف خيارات الخريطة
    const mapOptions = {
      center: [32.082203, 35.182099], // إحداثيات مركز سلفيت
      zoom: 18,
      zoomsnap: 0.2
    };

    // إنشاء الخريطة
    const map = L.map("map", mapOptions);

    // إضافة طبقة أساسية
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      maxZoom: 20
    }).addTo(map);

    // حدود مدينة سلفيت (GeoJSON افتراضي)
    const salfitBoundary = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "geometry": {
            "type": "Polygon",
            "coordinates": [[[35.181, 32.083], [35.182, 32.083], [35.182, 32.082], [35.181, 32.082], [35.181, 32.083]]]
          },
          "properties": {}
        }
      ]
    };

    // عرض حدود المدينة
    L.geoJson(salfitBoundary, {
      style: {
        color: "black",
        weight: 2,
        fillOpacity: 0
      }
    }).addTo(map);

    // بيانات الطرق (GeoJSON افتراضي)
    const roadData = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "geometry": {
            "type": "LineString",
            "coordinates": [[35.181, 32.083], [35.182, 32.082]]
          },
          "properties": {}
        }
      ]
    };

    // عرض الطرق
    L.geoJson(roadData, {
      style: {
        color: "black",
        weight: 0.5
      }
    }).addTo(map);

    // بيانات محطات المواصلات (GeoJSON افتراضي)
    const transportStations = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "geometry": { "type": "Point", "coordinates": [35.1812, 32.0833] },
          "properties": { "name": "محطة رقم 1", "price": 5 }
        },
        {
          "type": "Feature",
          "geometry": { "type": "Point", "coordinates": [35.1825, 32.0841] },
          "properties": { "name": "محطة رقم 2", "price": 3 }
        }
      ]
    };

    // عرض المحطات على الخريطة
    const stationLayer = L.geoJson(transportStations, {
      pointToLayer: function (feature, latlng) {
        return L.marker(latlng).bindPopup(
          `<strong>محطة:</strong> ${feature.properties.name}<br>
          <strong>السعر:</strong> ${feature.properties.price} شيكل`
        );
      }
    }).addTo(map);

    // تحديد موقع المستخدم
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const userLatLng = [position.coords.latitude, position.coords.longitude];
        L.marker(userLatLng, { title: "موقعك الحالي" }).addTo(map).bindPopup("أنت هنا!").openPopup();
        map.setView(userLatLng, 16);

        // تحديث الموقع في اللوحة
        document.getElementById("user-location").textContent = `${position.coords.latitude.toFixed(5)}, ${position.coords.longitude.toFixed(5)}`;

        // حساب أقرب محطة
        let nearestStation = null;
        let nearestDistance = Infinity;

        transportStations.features.forEach(function (feature) {
          const stationLatLng = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
          const distance = map.distance(userLatLng, stationLatLng);

          if (distance < nearestDistance) {
            nearestStation = feature;
            nearestDistance = distance;
          }
        });

        if (nearestStation) {
          document.getElementById("nearest-station").textContent = nearestStation.properties.name;
          document.getElementById("transport-price").textContent = `${nearestStation.properties.price} شيكل`;
        }
      });
    } else {
      alert("ميزة تحديد الموقع الجغرافي غير مدعومة في هذا المتصفح.");
    }
  </script>
</body>

</html>
